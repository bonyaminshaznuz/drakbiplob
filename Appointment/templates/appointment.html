{% extends 'base.html' %}

{% block content %}
<div class="space-y-8">
    <!-- Header Section -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
        <div>
            <div class="flex items-center gap-3 mb-2">
                <div
                    class="h-10 w-10 bg-blue-50 rounded-xl flex items-center justify-center text-blue-600 shadow-sm shadow-blue-50">
                    <i class="fas fa-calendar-alt text-lg"></i>
                </div>
                <h1 class="text-2xl font-extrabold text-gray-900 tracking-tight">Appointment Requests</h1>
            </div>
            <p class="text-sm text-gray-500 font-medium ml-1">Efficiently manage your patient schedule and bookings</p>
        </div>
        <div class="flex items-center">
            <div class="bg-white px-5 py-2.5 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-3">
                <div class="h-2 w-2 rounded-full bg-blue-500 animate-pulse"></div>
                <span class="text-sm font-bold text-gray-700">
                    {{ appointments|length }} Requests
                </span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <!-- Desktop Table View -->
        <div class="hidden md:block overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-gray-50/50 border-b border-gray-100">
                        <th class="px-6 py-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">Patient
                            Details</th>
                        <th class="px-6 py-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">Schedule</th>
                        <th class="px-6 py-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">Contact</th>
                        <th class="px-6 py-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">Reason</th>
                        <th class="px-6 py-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-4 text-xs font-semibold text-gray-600 uppercase tracking-wider text-right">
                            Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-50">
                    {% for appt in appointments %}
                    <tr class="hover:bg-blue-50/30 transition-colors group">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div
                                    class="h-10 w-10 flex-shrink-0 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold">
                                    {{ appt.full_name|slice:":1"|upper }}
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-bold text-gray-900">{{ appt.full_name }}</div>
                                    <div class="text-[10px] text-gray-400 font-medium">ID: {{ appt.formatted_id }}</div>
                                    <div class="text-xs text-gray-500">{{ appt.email|default:"No email provided" }}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex flex-col">
                                <span class="text-sm font-medium text-gray-900 flex items-center">
                                    <i class="far fa-calendar text-gray-400 mr-2"></i>
                                    {{ appt.slot.date }}
                                </span>
                                <span class="text-xs text-gray-500 mt-1 flex items-center">
                                    <i class="far fa-clock text-gray-400 mr-2"></i>
                                    {{ appt.slot.time }}
                                </span>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <a href="tel:{{ appt.phone_number }}"
                                class="text-sm text-blue-600 hover:underline flex items-center font-medium">
                                <i class="fas fa-phone-alt mr-2 text-xs"></i>
                                {{ appt.phone_number }}
                            </a>
                        </td>
                        <td class="px-6 py-4">
                            <div class="max-w-xs text-sm text-gray-600 italic truncate" title="{{ appt.reason }}">
                                "{{ appt.reason|default:"No reason provided" }}"
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            {% if appt.status == 'confirmed' %}
                            <span
                                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                <i class="fas fa-check-circle mr-1"></i> Confirmed
                            </span>
                            {% elif appt.status == 'cancelled' %}
                            <span
                                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                <i class="fas fa-times-circle mr-1"></i> Cancelled
                            </span>
                            {% else %}
                            <span
                                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                <i class="fas fa-clock mr-1"></i> Pending
                            </span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 text-right">
                            <div class="flex justify-end gap-2">
                                {% if appt.status == 'pending' %}
                                <a href="{% url 'admin-confirm-appointment' appt.pk %}"
                                    class="inline-flex items-center px-3 py-1.5 bg-green-50 text-green-700 text-xs font-bold rounded-lg hover:bg-green-100 transition-colors">
                                    <i class="fas fa-check mr-1.5"></i> Confirm
                                </a>
                                <a href="{% url 'admin-cancel-appointment' appt.pk %}"
                                    class="inline-flex items-center px-3 py-1.5 bg-red-50 text-red-700 text-xs font-bold rounded-lg hover:bg-red-100 transition-colors">
                                    <i class="fas fa-times mr-1.5"></i> Cancel
                                </a>
                                {% elif appt.status == 'confirmed' %}
                                <a href="{% url 'admin-cancel-appointment' appt.pk %}"
                                    class="inline-flex items-center px-3 py-1.5 bg-red-50 text-red-700 text-xs font-bold rounded-lg hover:bg-red-100 transition-colors">
                                    <i class="fas fa-times mr-1.5"></i> Cancel
                                </a>
                                {% elif appt.status == 'cancelled' %}
                                <a href="{% url 'admin-confirm-appointment' appt.pk %}"
                                    class="inline-flex items-center px-3 py-1.5 bg-green-50 text-green-700 text-xs font-bold rounded-lg hover:bg-green-100 transition-colors">
                                    <i class="fas fa-check mr-1.5"></i> Re-confirm
                                </a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="px-6 py-12 text-center">
                            <div class="flex flex-col items-center">
                                <div class="h-16 w-16 bg-gray-50 rounded-full flex items-center justify-center mb-4">
                                    <i class="fas fa-calendar-minus text-2xl text-gray-300"></i>
                                </div>
                                <h3 class="text-lg font-medium text-gray-900">No appointments found</h3>
                                <p class="text-sm text-gray-500">Wait for patients to book slots.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Mobile Card View -->
        <div class="md:hidden divide-y divide-gray-100">
            {% for appt in appointments %}
            <div class="p-4 space-y-4">
                <div class="flex items-start justify-between">
                    <div class="flex items-center">
                        <div
                            class="h-10 w-10 flex-shrink-0 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold">
                            {{ appt.full_name|slice:":1"|upper }}
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-bold text-gray-900">{{ appt.full_name }}</h3>
                            <div class="flex items-center gap-2">
                                <p class="text-[10px] text-gray-500 font-bold">ID: {{ appt.formatted_id }}</p>
                                <p class="text-xs text-gray-500">{{ appt.email|default:"No email" }}</p>
                                {% if appt.status == 'confirmed' %}
                                <span
                                    class="bg-green-100 text-green-800 text-[10px] px-1.5 py-0.5 rounded-full font-bold">Confirmed</span>
                                {% elif appt.status == 'cancelled' %}
                                <span
                                    class="bg-red-100 text-red-800 text-[10px] px-1.5 py-0.5 rounded-full font-bold">Cancelled</span>
                                {% else %}
                                <span
                                    class="bg-yellow-100 text-yellow-800 text-[10px] px-1.5 py-0.5 rounded-full font-bold">Pending</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3 py-2">
                    <div class="bg-gray-50 p-2 rounded-lg">
                        <p class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-1">Schedule</p>
                        <p class="text-xs font-medium text-gray-900">{{ appt.slot.date }}</p>
                        <p class="text-[10px] text-gray-500">{{ appt.slot.time }}</p>
                    </div>
                    <div class="bg-gray-50 p-2 rounded-lg">
                        <p class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-1">Contact</p>
                        <a href="tel:{{ appt.phone_number }}" class="text-xs font-bold text-blue-600 hover:underline">
                            <i class="fas fa-phone-alt mr-1 text-[10px]"></i> {{ appt.phone_number }}
                        </a>
                    </div>
                </div>

                <div class="text-xs text-gray-600 bg-blue-50/50 p-3 rounded-lg italic">
                    "{{ appt.reason|default:"No reason provided"|truncatechars:100 }}"
                </div>

                <div class="flex gap-2 pt-2">
                    {% if appt.status == 'pending' %}
                    <a href="{% url 'admin-confirm-appointment' appt.pk %}"
                        class="flex-1 inline-flex justify-center items-center px-4 py-2.5 bg-green-600 text-white text-xs font-bold rounded-xl hover:bg-green-700 transition-colors shadow-sm shadow-green-200">
                        <i class="fas fa-check mr-2"></i> Confirm
                    </a>
                    <a href="{% url 'admin-cancel-appointment' appt.pk %}"
                        class="flex-1 inline-flex justify-center items-center px-4 py-2.5 bg-white border border-red-200 text-red-600 text-xs font-bold rounded-xl hover:bg-red-50 transition-colors">
                        <i class="fas fa-times mr-2"></i> Cancel
                    </a>
                    {% elif appt.status == 'confirmed' %}
                    <a href="{% url 'admin-cancel-appointment' appt.pk %}"
                        class="flex-1 inline-flex justify-center items-center px-4 py-2.5 bg-white border border-red-200 text-red-600 text-xs font-bold rounded-xl hover:bg-red-50 transition-colors">
                        <i class="fas fa-times mr-2"></i> Cancel
                    </a>
                    {% elif appt.status == 'cancelled' %}
                    <a href="{% url 'admin-confirm-appointment' appt.pk %}"
                        class="flex-1 inline-flex justify-center items-center px-4 py-2.5 bg-green-600 text-white text-xs font-bold rounded-xl hover:bg-green-700 transition-colors shadow-sm shadow-green-200">
                        <i class="fas fa-check mr-2"></i> Re-confirm
                    </a>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="p-8 text-center">
                <i class="fas fa-calendar-minus text-3xl text-gray-200 mb-3"></i>
                <p class="text-sm font-medium text-gray-900">No appointments found</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}