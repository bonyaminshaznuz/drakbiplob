{% extends "base.html" %}

{% block content %}
<div class="w-full max-w-6xl mx-auto px-3 sm:px-4 lg:px-6 xl:px-8 py-3 sm:py-4 lg:py-6 overflow-x-hidden">
    <div class="mb-4 sm:mb-6">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Footer Settings</h1>
        <p class="text-sm sm:text-base text-gray-600">Configure footer content, links, and social media</p>
    </div>

    <form method="post" class="bg-white rounded-xl sm:rounded-2xl shadow-lg border border-gray-100 p-3 sm:p-4 lg:p-6 xl:p-8 space-y-4 sm:space-y-6 lg:space-y-8 w-full overflow-x-hidden">
        {% csrf_token %}
        
        <div class="border-b border-gray-200 pb-4 sm:pb-6">
            <h2 class="text-lg sm:text-xl font-bold text-gray-900 mb-3 sm:mb-4">Brand Information</h2>
            <div class="space-y-4 sm:space-y-6">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Logo Icon</label>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="text" id="footer-logo-icon-input" name="logo_icon" value="{{ footer.logo_icon|default:'fas fa-stethoscope' }}" class="flex-1 px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base" placeholder="fas fa-stethoscope">
                        <button type="button" onclick="openIconPicker('footer-logo-icon-input')" class="px-4 sm:px-6 py-2 sm:py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg sm:rounded-xl font-semibold text-sm sm:text-base shadow-lg transition-colors whitespace-nowrap">
                            <i class="fas fa-icons mr-1 sm:mr-2"></i>Pick
                        </button>
                    </div>
                    <div id="footer-logo-icon-preview" class="mt-3 flex flex-wrap items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-gray-50 rounded-lg sm:rounded-xl">
                        <span class="text-gray-500 text-xs sm:text-sm">Preview:</span>
                        <i id="footer-logo-preview-icon" class="text-xl sm:text-2xl text-gray-400"></i>
                        <span id="footer-logo-preview-text" class="text-xs sm:text-sm text-gray-500 break-all"></span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Doctor Name</label>
                    <input type="text" name="doctor_name" value="{{ footer.doctor_name|default:'' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Description</label>
                    <textarea name="description" rows="3" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base resize-y overflow-x-auto">{{ footer.description|default:'' }}</textarea>
                </div>
            </div>
        </div>

        <div class="border-b border-gray-200 pb-4 sm:pb-6">
            <h2 class="text-lg sm:text-xl font-bold text-gray-900 mb-3 sm:mb-4">Contact Information</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Address</label>
                    <input type="text" name="address" value="{{ footer.address|default:'' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Phone Number</label>
                    <input type="text" name="phone_number" value="{{ footer.phone_number|default:'' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Email</label>
                    <input type="email" name="email" value="{{ footer.email|default:'' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Working Hours</label>
                    <input type="text" name="working_hours" value="{{ footer.working_hours|default:'' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
                </div>
            </div>
        </div>

        <div class="border-b border-gray-200 pb-4 sm:pb-6 overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg sm:text-xl font-bold text-gray-900">Footer Sections</h2>
                <button type="button" onclick="addSection()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition-colors">
                    <i class="fas fa-plus mr-2"></i>Add Section
                </button>
            </div>
            <div id="sections_container" class="space-y-6">
                <!-- Sections will be added here dynamically -->
            </div>
            <textarea name="footer_sections" id="footer_sections_json" style="display: none;"></textarea>
            <script type="application/json" id="footer_sections_json_init">{{ footer_sections_json|safe|default:"[]" }}</script>
        </div>

        <div class="border-b border-gray-200 pb-4 sm:pb-6 overflow-hidden">
            <h2 class="text-lg sm:text-xl font-bold text-gray-900 mb-3 sm:mb-4">Social Media Links</h2>
            <div class="mb-3 sm:mb-4 overflow-hidden">
                <label class="block text-sm font-bold text-gray-700 mb-2">Section Title</label>
                <input type="text" name="social_media_title" value="{{ footer.social_media_title|default:'Follow Us' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6">
                <div class="overflow-hidden">
                    <label class="block text-sm font-bold text-gray-700 mb-2">Facebook URL</label>
                    <input type="url" name="facebook_url" value="{{ footer.facebook_url|default:'' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base overflow-x-auto" placeholder="https://facebook.com/...">
                </div>
                <div class="overflow-hidden">
                    <label class="block text-sm font-bold text-gray-700 mb-2">Twitter URL</label>
                    <input type="url" name="twitter_url" value="{{ footer.twitter_url|default:'' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base overflow-x-auto" placeholder="https://twitter.com/...">
                </div>
                <div class="overflow-hidden">
                    <label class="block text-sm font-bold text-gray-700 mb-2">LinkedIn URL</label>
                    <input type="url" name="linkedin_url" value="{{ footer.linkedin_url|default:'' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base overflow-x-auto" placeholder="https://linkedin.com/...">
                </div>
                <div class="overflow-hidden">
                    <label class="block text-sm font-bold text-gray-700 mb-2">Instagram URL</label>
                    <input type="url" name="instagram_url" value="{{ footer.instagram_url|default:'' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base overflow-x-auto" placeholder="https://instagram.com/...">
                </div>
                <div class="overflow-hidden">
                    <label class="block text-sm font-bold text-gray-700 mb-2">YouTube URL</label>
                    <input type="url" name="youtube_url" value="{{ footer.youtube_url|default:'' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base overflow-x-auto" placeholder="https://youtube.com/...">
                </div>
            </div>
        </div>

        <div class="border-b border-gray-200 pb-4 sm:pb-6 overflow-hidden">
            <h2 class="text-lg sm:text-xl font-bold text-gray-900 mb-3 sm:mb-4">Footer Bottom</h2>
            <div class="mb-3 sm:mb-4 overflow-hidden">
                <label class="block text-sm font-bold text-gray-700 mb-2">Copyright Text</label>
                <input type="text" name="copyright_text" value="{{ footer.copyright_text|default:'' }}" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
            </div>
        </div>

        <div class="flex items-center pt-2 sm:pt-4 overflow-hidden">
            <input type="checkbox" name="is_active" {% if footer.is_active or not footer %}checked{% endif %} class="h-4 w-4 sm:h-5 sm:w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500 flex-shrink-0">
            <label class="ml-2 sm:ml-3 text-xs sm:text-sm font-semibold text-gray-700 break-words">Active (Display on website)</label>
        </div>

        <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 pt-4 sm:pt-6 overflow-hidden">
            <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg sm:rounded-xl font-semibold text-sm sm:text-base shadow-lg transition-colors whitespace-nowrap">
                <i class="fas fa-save mr-2"></i>Save Settings
            </button>
            <a href="{% url 'admin-portfolio-dashboard' %}" class="px-4 sm:px-6 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 text-gray-700 font-semibold text-sm sm:text-base hover:bg-gray-50 transition-colors text-center whitespace-nowrap">
                Back to Dashboard
            </a>
        </div>
    </form>
</div>

<!-- Icon Picker Modal -->
<div id="icon-picker-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[9999] flex items-center justify-center p-2 sm:p-4 overflow-hidden">
    <div class="bg-white rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-4xl max-h-[95vh] sm:max-h-[90vh] flex flex-col m-2 sm:m-4 overflow-hidden">
        <div class="p-4 sm:p-6 border-b border-gray-200">
            <div class="flex items-center justify-between mb-3 sm:mb-0">
                <h2 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900">Select Font Awesome Icon</h2>
                <button onclick="closeIconPicker()" class="text-gray-400 hover:text-gray-600 text-2xl sm:text-3xl leading-none">&times;</button>
            </div>
            <div class="mt-3 sm:mt-4">
                <input type="text" id="icon-search" placeholder="Search icons (e.g., heart, syringe)" class="w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
            </div>
        </div>
        <div id="icon-grid" class="flex-1 overflow-y-auto p-3 sm:p-4 lg:p-6 grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-2 sm:gap-3">
            <!-- Icons will be loaded here -->
        </div>
    </div>
</div>

<!-- Font Awesome 6.5.1 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<script>
// Font Awesome 6.5.1 Icon List
const fontAwesomeIcons = [
    'fas fa-heartbeat', 'fas fa-heart', 'fas fa-stethoscope', 'fas fa-user-md', 'fas fa-hospital',
    'fas fa-ambulance', 'fas fa-pills', 'fas fa-syringe', 'fas fa-x-ray', 'fas fa-band-aid',
    'fas fa-lungs', 'fas fa-brain', 'fas fa-tooth', 'fas fa-eye', 'fas fa-ear',
    'fas fa-hand-holding-medical', 'fas fa-procedures', 'fas fa-notes-medical', 'fas fa-file-medical',
    'fas fa-prescription-bottle', 'fas fa-capsules', 'fas fa-thermometer-half', 'fas fa-microscope',
    'fas fa-home', 'fas fa-user', 'fas fa-users', 'fas fa-envelope', 'fas fa-phone',
    'fas fa-calendar', 'fas fa-calendar-check', 'fas fa-clock', 'fas fa-map-marker-alt', 'fas fa-globe',
    'fas fa-link', 'fas fa-image', 'fas fa-video', 'fas fa-music', 'fas fa-file', 'fas fa-folder',
    'fas fa-search', 'fas fa-bell', 'fas fa-star', 'fas fa-thumbs-up', 'fas fa-share', 'fas fa-download',
    'fas fa-upload', 'fas fa-print', 'fas fa-edit', 'fas fa-trash', 'fas fa-save', 'fas fa-check',
    'fas fa-times', 'fas fa-plus', 'fas fa-minus', 'fas fa-arrow-right', 'fas fa-arrow-left',
    'fas fa-chevron-right', 'fas fa-chevron-left', 'fas fa-bars', 'fas fa-cog', 'fas fa-wrench',
    'fas fa-lock', 'fas fa-unlock', 'fas fa-key', 'fas fa-shield-alt', 'fas fa-info-circle',
    'fas fa-briefcase', 'fas fa-building', 'fas fa-store', 'fas fa-shopping-cart', 'fas fa-chart-line',
    'fas fa-handshake', 'fas fa-award', 'fas fa-trophy', 'fas fa-medal', 'fas fa-certificate',
    'fas fa-graduation-cap', 'fas fa-book', 'fas fa-laptop', 'fas fa-desktop', 'fas fa-mobile-alt',
    'fas fa-comments', 'fas fa-comment', 'fas fa-paper-plane', 'fas fa-inbox', 'fab fa-facebook',
    'fab fa-twitter', 'fab fa-instagram', 'fab fa-linkedin', 'fab fa-youtube', 'fab fa-github',
    'fas fa-car', 'fas fa-bus', 'fas fa-train', 'fas fa-plane', 'fas fa-sun', 'fas fa-moon',
    'fas fa-cloud', 'fas fa-tree', 'fas fa-fire', 'fas fa-water', 'fas fa-lightbulb', 'fas fa-play',
    'fas fa-pause', 'fas fa-stop', 'fas fa-redo', 'fas fa-undo', 'fas fa-refresh', 'fas fa-spinner'
];

let currentIconInput = null;

function openIconPicker(inputId) {
    currentIconInput = document.getElementById(inputId);
    document.getElementById('icon-picker-modal').classList.remove('hidden');
    loadIcons();
    updatePreview();
}

function closeIconPicker() {
    document.getElementById('icon-picker-modal').classList.add('hidden');
    document.getElementById('icon-search').value = '';
    currentIconInput = null;
}

function loadIcons(searchTerm = '') {
    const grid = document.getElementById('icon-grid');
    grid.innerHTML = '';
    
    const filteredIcons = fontAwesomeIcons.filter(icon => {
        const iconName = icon.replace('fas fa-', '').replace('fab fa-', '');
        return iconName.includes(searchTerm.toLowerCase());
    });
    
    filteredIcons.forEach(icon => {
        const iconDiv = document.createElement('div');
        iconDiv.className = 'flex flex-col items-center justify-center p-2 sm:p-3 rounded-lg border border-gray-200 hover:border-blue-500 hover:bg-blue-50 cursor-pointer transition-all min-h-[80px] sm:min-h-[100px]';
        iconDiv.onclick = () => selectIcon(icon);
        
        const iconElement = document.createElement('i');
        iconElement.className = icon + ' text-xl sm:text-2xl text-gray-700 mb-1 sm:mb-2';
        iconDiv.appendChild(iconElement);
        
        const iconText = document.createElement('span');
        iconText.className = 'text-[10px] sm:text-xs text-gray-600 text-center break-all px-1';
        iconText.textContent = icon;
        iconDiv.appendChild(iconText);
        
        grid.appendChild(iconDiv);
    });
    
    if (filteredIcons.length === 0) {
        grid.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">No icons found</div>';
    }
}

function selectIcon(icon) {
    if (currentIconInput) {
        currentIconInput.value = icon;
        updatePreview();
        closeIconPicker();
    }
}

function updatePreview() {
    const footerLogoInput = document.getElementById('footer-logo-icon-input');
    
    if (footerLogoInput && footerLogoInput.value) {
        document.getElementById('footer-logo-preview-icon').className = footerLogoInput.value + ' text-xl sm:text-2xl text-blue-600';
        document.getElementById('footer-logo-preview-text').textContent = footerLogoInput.value;
        document.getElementById('footer-logo-icon-preview').classList.remove('hidden');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('icon-search');
    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            loadIcons(e.target.value);
        });
    }
    
    const footerLogoInput = document.getElementById('footer-logo-icon-input');
    if (footerLogoInput) {
        footerLogoInput.addEventListener('input', updatePreview);
    }
    
    updatePreview();
    
    document.getElementById('icon-picker-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeIconPicker();
        }
    });
});

// Dynamic Sections Management
let sectionCounter = 0;

// Initialize sections from JSON on page load
document.addEventListener('DOMContentLoaded', function() {
    try {
        const sectionsJsonStr = document.getElementById('footer_sections_json_init')?.textContent || '[]';
        const sectionsJson = JSON.parse(sectionsJsonStr);
        if (sectionsJson && Array.isArray(sectionsJson)) {
            sectionsJson.forEach(section => {
                addSection(section.title || '', section.links || []);
            });
        }
    } catch(e) {
        console.error('Error parsing footer sections:', e);
    }
    
    // Convert to JSON before form submission
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            updateSectionsJSON();
        });
    }
});

function addSection(title = '', links = []) {
    const container = document.getElementById('sections_container');
    const sectionId = `section_${sectionCounter++}`;
    const sectionDiv = document.createElement('div');
    sectionDiv.className = 'p-4 sm:p-6 bg-gray-50 rounded-xl border-2 border-gray-200';
    sectionDiv.id = sectionId;
    
    let linksHtml = '';
    if (links && Array.isArray(links)) {
        links.forEach(link => {
            const linkId = `link_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            linksHtml += `
                <div class="link-item flex flex-col sm:flex-row gap-3 p-3 bg-white rounded-lg border border-gray-300" data-link-id="${linkId}">
                    <div class="flex-1">
                        <label class="block text-xs font-semibold text-gray-700 mb-1">Title</label>
                        <input type="text" class="link-label w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm" value="${(link.label || '').replace(/"/g, '&quot;')}" placeholder="e.g., Home">
                    </div>
                    <div class="flex-1">
                        <label class="block text-xs font-semibold text-gray-700 mb-1">Link</label>
                        <input type="text" class="link-href w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm" value="${(link.href || '').replace(/"/g, '&quot;')}" placeholder="e.g., / or /#about">
                    </div>
                    <div class="flex items-end">
                        <button type="button" onclick="removeSectionLink('${sectionId}', '${linkId}')" class="px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        });
    }
    
    sectionDiv.innerHTML = `
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-base sm:text-lg font-bold text-gray-800">Section</h3>
            <button type="button" onclick="removeSection('${sectionId}')" class="px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                <i class="fas fa-trash mr-2"></i>Remove Section
            </button>
        </div>
        <div class="mb-4">
            <label class="block text-sm font-bold text-gray-700 mb-2">Section Title</label>
            <input type="text" class="section-title w-full px-3 sm:px-4 py-2 sm:py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm sm:text-base" value="${title.replace(/"/g, '&quot;')}" placeholder="e.g., Quick Links">
        </div>
        <div class="mb-3">
            <label class="block text-sm font-bold text-gray-700 mb-3">Links</label>
            <div class="section-links space-y-3">
                ${linksHtml || '<!-- Links will be added here -->'}
            </div>
            <button type="button" onclick="addSectionLink('${sectionId}')" class="mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold transition-colors">
                <i class="fas fa-plus mr-2"></i>Add Link
            </button>
        </div>
    `;
    container.appendChild(sectionDiv);
    attachSectionChangeListeners(sectionId);
}

function addSectionLink(sectionId) {
    const sectionDiv = document.getElementById(sectionId);
    if (!sectionDiv) return;
    
    const linksContainer = sectionDiv.querySelector('.section-links');
    const linkId = `link_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    const linkDiv = document.createElement('div');
    linkDiv.className = 'link-item flex flex-col sm:flex-row gap-3 p-3 bg-white rounded-lg border border-gray-300';
    linkDiv.setAttribute('data-link-id', linkId);
    linkDiv.innerHTML = `
        <div class="flex-1">
            <label class="block text-xs font-semibold text-gray-700 mb-1">Title</label>
            <input type="text" class="link-label w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm" placeholder="e.g., Home">
        </div>
        <div class="flex-1">
            <label class="block text-xs font-semibold text-gray-700 mb-1">Link</label>
            <input type="text" class="link-href w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 text-sm" placeholder="e.g., / or /#about">
        </div>
        <div class="flex items-end">
            <button type="button" onclick="removeSectionLink('${sectionId}', '${linkId}')" class="px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;
    linksContainer.appendChild(linkDiv);
    attachSectionChangeListeners(sectionId);
}

function removeSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
        section.remove();
        updateSectionsJSON();
    }
}

function removeSectionLink(sectionId, linkId) {
    const sectionDiv = document.getElementById(sectionId);
    if (!sectionDiv) return;
    
    const linkItem = sectionDiv.querySelector(`[data-link-id="${linkId}"]`);
    if (linkItem) {
        linkItem.remove();
        attachSectionChangeListeners(sectionId);
    }
}

function attachSectionChangeListeners(sectionId) {
    setTimeout(() => {
        const sectionDiv = document.getElementById(sectionId);
        if (!sectionDiv) return;
        
        const inputs = sectionDiv.querySelectorAll('.section-title, .link-label, .link-href');
        inputs.forEach(input => {
            input.removeEventListener('input', updateSectionsJSON);
            input.addEventListener('input', updateSectionsJSON);
        });
    }, 100);
}

function updateSectionsJSON() {
    const container = document.getElementById('sections_container');
    if (!container) return;
    
    let sections = [];
    const sectionDivs = container.querySelectorAll('[id^="section_"]');
    
    sectionDivs.forEach(sectionDiv => {
        const titleInput = sectionDiv.querySelector('.section-title');
        const linksContainer = sectionDiv.querySelector('.section-links');
        const title = titleInput ? titleInput.value.trim() : '';
        
        let links = [];
        if (linksContainer) {
            const linkItems = linksContainer.querySelectorAll('.link-item');
            linkItems.forEach(linkItem => {
                const labelInput = linkItem.querySelector('.link-label');
                const hrefInput = linkItem.querySelector('.link-href');
                if (labelInput && hrefInput) {
                    const label = labelInput.value.trim();
                    const href = hrefInput.value.trim();
                    if (label || href) {
                        links.push({ label: label, href: href });
                    }
                }
            });
        }
        
        if (title || links.length > 0) {
            sections.push({ title: title, links: links });
        }
    });
    
    const jsonTextarea = document.getElementById('footer_sections_json');
    if (jsonTextarea) {
        jsonTextarea.value = JSON.stringify(sections);
    }
}
</script>
{% endblock %}
